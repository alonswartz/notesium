<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notesium Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="forcegraph.js"></script>
    <style>
      #forcegraph { margin: auto; width: 97vw; height: 97vh; color: #e2e8f0; }
      #forcegraph .node { fill: #ff7f0e; cursor: pointer; }
      #forcegraph .node-lbl { fill: #1f77b4; cursor: pointer; }
      #forcegraph .link { stroke-width: 0.5; }
      #forcegraph .label { fill: #475569; font-size: 4px; }
      #forcegraph .label:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div id="forcegraph-settings">
      <div>
        <input id="forcegraph-filter" placeholder="filter" type="text" autofocus>
      </div>
      <div>
        <label for="forcegraph-labels">labels</label>
        <input id="forcegraph-labels" type="checkbox" checked>
      </div>
      <div>
        <label for="forcegraph-scale-labels">scale labels</label>
        <input id="forcegraph-scale-labels" type="checkbox" checked>
      </div>
      <div>
        <label for="forcegraph-dynamic-radius">dynamic radius</label>
        <input id="forcegraph-dynamic-radius" type="checkbox">
      </div>
    </div>
    <div id="forcegraph"></div>
    <script type="text/javascript">
      const dataB64 = new URLSearchParams(location.search).get('data');
      const dataStr = atob(dataB64);
      const dataArr = dataStr.split("-----\n");

      const data = {
        "href": dataArr[0],
        "nodes": d3.csvParse(dataArr[1]),
        "links": d3.csvParse(dataArr[2])
      };

      // dangling links
      const nodes = data.nodes.map(n => n.id);
      const targets = data.links.map(l => l.target);
      const dangling = targets.filter(id => !nodes.includes(id));
      dangling.forEach(id => data.nodes.push({'id': id, 'title': 'dangling link'}));

      initialize_forcegraph(data, '#forcegraph');
    </script>
  </body>
</html>

